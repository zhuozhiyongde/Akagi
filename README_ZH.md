<div align="center">
  <img src="https://github.com/shinkuan/RandomStuff/assets/35415788/db94b436-c3d4-4c57-893e-8db2074d2d22" width="50%">
  <h1 align="center">Akagi</h1>

  <div align="center">
  ã€Œæ­»ã­ã°åŠ©ã‹ã‚‹ã®ã«â€¦â€¦â€¦ã€- èµ¤æœ¨ã—ã’ã‚‹<br>
  <div align="center">
  <a href="./README.md">English</a> | <a href="./README_TW.md">ç¹é«”ä¸­æ–‡</a>
  <br/>
  <a href="https://github.com/shinkuan/Akagi/issues">æŠ¥å‘Šé”™è¯¯</a> | <a href="https://github.com/shinkuan/Akagi/issues">åŠŸèƒ½è¯·æ±‚</a> | 
  <a href="https://discord.gg/Z2wjXUK8bN">æœ‰é—®é¢˜è¯·è‡³ Discord è¯¢é—®</a>
  <br/>
  <br/>
  </div>
  </div>
</div>

<div align="center">
  <a href="https://github.com/shinkuan/Akagi"><img src="https://img.shields.io/github/stars/shinkuan/Akagi?logo=github" alt="GitHub stars" /></a>
  <a href="https://github.com/shinkuan/Akagi/releases"><img src="https://img.shields.io/github/v/release/shinkuan/Akagi?label=release&logo=github" alt="GitHub release" /></a>
  <a href="https://github.com/shinkuan/Akagi/issues"><img src="https://img.shields.io/github/issues/shinkuan/Akagi?logo=github" alt="GitHub issues" /></a>
  <a href="https://github.com/shinkuan/Akagi"><img src="https://img.shields.io/github/languages/top/shinkuan/Akagi?logo=python" alt="Top language" /></a>
  <a href="https://discord.gg/Z2wjXUK8bN"><img src="https://img.shields.io/discord/1192792431364673577?label=discord&logo=discord&color=7289DA" alt="Discord" /></a>
  <a href="https://deepwiki.com/shinkuan/Akagi"><img src="https://deepwiki.com/badge.svg" alt="Ask DeepWiki"></a>
</div>

## å…³äº

> [!CAUTION]
>
> æœ¬é¡¹ç›®æ—¨åœ¨æä¾›ä¸€ä¸ªä¾¿åˆ©çš„æ–¹å¼ï¼Œè®©ç©å®¶å¯ä»¥å®æ—¶äº†è§£è‡ªå·±åœ¨éº»å°†å¯¹å±€ä¸­çš„è¡¨ç°ï¼Œå¹¶å€Ÿæ­¤å­¦ä¹ ä¸è¿›æ­¥ã€‚æ­¤é¡¹ç›®ä»…ä¾›æ•™è‚²ç”¨é€”ï¼Œä½œè€…ä¸å¯¹ä½¿ç”¨è€…åˆ©ç”¨æ­¤é¡¹ç›®é‡‡å–çš„ä»»ä½•è¡Œä¸ºè´Ÿè´£ã€‚è‹¥ä½¿ç”¨è€…è¿åæ¸¸æˆæœåŠ¡æ¡æ¬¾ï¼Œæ¸¸æˆå¼€å‘è€…ä¸å‘è¡Œå•†æœ‰æƒè¿›è¡Œå¤„ç½®ï¼ŒåŒ…å«è´¦å·å°ç¦ç­‰åæœï¼Œä¸ä½œè€…æ— å…³ã€‚

![image](./docs/images/example_majsoul.png)

## åŠŸèƒ½

-   å®æ—¶æ˜¾ç¤ºå¯¹å±€ä¿¡æ¯
-   å®æ—¶æ˜¾ç¤º AI è¯„ä¼°
-   æ”¯æŒé›€é­‚ã€å¤©å‡¤ã€éº»é›€ä¸€ç•ªè¡—ã€å¤©æœˆ
-   æ”¯æŒå››äººéº»å°†ä¸ä¸‰äººéº»å°†
-   å¯ä½¿ç”¨å¤šç§ AI æ¨¡å‹
    -   å†…å»ºæ¨¡å‹
    -   åœ¨çº¿æœåŠ¡å™¨æ¨¡å‹
    -   è‡ªåˆ¶æ¨¡å‹
-   è‡ªåŠ¨åŒ–å¯¹å±€ï¼ˆåªæœ‰åœ¨ Windows Release ç‰ˆä¸­å¼€å¯åœ¨çº¿æœåŠ¡å™¨æ¨¡å‹æ—¶å¯ç”¨ï¼‰
-   TUI ç•Œé¢ï¼Œæ”¯æŒå¤šç§ä¸»é¢˜

## ç›®å½•

> [!WARNING]
>
> ä»”ç»†é˜…è¯»ä»¥ä¸‹å†…å®¹å†å¼€å§‹ä½¿ç”¨

-   [å…³äº](##å…³äº)
-   [åŠŸèƒ½](##åŠŸèƒ½)
-   [å¼€å§‹å‰](##å¼€å§‹å‰)
    -   [å‰ç½®è¦æ±‚](##å‰ç½®è¦æ±‚)
    -   [æ”¯æŒçŠ¶å†µ](##æ”¯æŒçŠ¶å†µ)
-   [å®‰è£…](##å®‰è£…)
    -   [ä¸€èˆ¬ä½¿ç”¨è€…](##ä¸€èˆ¬ä½¿ç”¨è€…)
    -   [å¼€å‘è€…](##å¼€å‘è€…)

## å¼€å§‹å‰

[ğŸ¥ æ•™å­¦è§†é¢‘](https://youtu.be/Z88Ncxbe2nw)

### å‰ç½®è¦æ±‚

ä¸ºäº†ä½¿ç”¨æœ¬é¡¹ç›®ï¼Œä½ éœ€è¦å‡†å¤‡ï¼š

1. ä¸€ä¸ª `mjai_bot`
    1. æ­¤é¡¹ç›®å·²ç»åŒ…å«ä¸€ä¸ªå¯ç”¨çš„ `mortal` mjai bot åœ¨ [è¿™è¾¹](./mjai_bot/mortal)
        - ç”±äºä»“åº“å¤§å°é™åˆ¶ï¼Œåœ¨ `./mjai_bot/mortal` ä¸‹çš„ `mortal.pth` æ˜¯ä¸€ä¸ªè¾ƒå°çš„æ¨¡å‹
        - ä¸å»ºè®®åœ¨å®é™…å¯¹å±€ä¸­ä½¿ç”¨
        - è‹¥æƒ³å–å¾—å…¶ä»–æ¨¡å‹ï¼Œå¯ä»¥ä» [Discord](https://discord.gg/Z2wjXUK8bN) å–å¾—ï¼Œè¿™é‡Œæä¾›äº†ç›¸å½“äºé›€é­‚é›€è±ªæ®µä½çš„ Mortal V4 æ¨¡å‹ï¼ˆ~100MBï¼‰ï¼Œä½†æ˜¯ä½ å¯èƒ½éœ€è¦ç•¥å¾®ä¿®æ”¹å…¶ä»£ç ä»¥é€‚é…æœ¬æ¡†æ¶ã€‚
        - è‹¥æƒ³å–ç”¨æ›´å¼ºçš„ AI æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨çº¿æœåŠ¡å™¨æ¶è®¾çš„æ¨¡å‹ï¼ˆå³ `ot_server`ï¼‰ï¼Œè¿™éœ€è¦ä» [Discord](https://discord.gg/Z2wjXUK8bN) å–å¾— API å¯†é’¥ï¼Œå…¶æ°´å¹³ç›¸å½“äºé›€é­‚é­‚å¤©æ®µä½ã€‚
    2. æˆ–è‡ªè¡Œåˆ¶ä½œï¼Œè¯·å‚é˜… [å¼€å‘è€…](#å¼€å‘è€…)
2. ä½¿ç”¨ Windows Terminal(Windows) / Terminal(macOS) å¼€å¯ Akagi æ‰èƒ½çœ‹åˆ°æ¼‚äº®çš„ TUIï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨é…ç½®ä¸­ç¦ç”¨ TUI ç•Œé¢ï¼Œè½¬ä¸ºå¯ç”¨ DataServer è¿›è¡Œå‰åç«¯åˆ†ç¦»ï¼Œä½¿ç”¨ [AkagiFrontend](https://github.com/zhuozhiyongde/AkagiFrontend) æ¥æ˜¾ç¤ºå¯¹å±€ä¿¡æ¯ã€‚è¿™å°†å…è®¸æ‚¨ä½¿ç”¨ PiP ç”»ä¸­ç”»æ¨¡å¼å®æ—¶æŸ¥çœ‹æç¤ºï¼Œä»è€Œåœ¨ iOS / iPadOS ç­‰ç§»åŠ¨ç«¯è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œå…·ä½“éƒ¨ç½²æ–¹æ³•è¯·å‚é˜…åæ–‡ [ä½¿ç”¨æ–¹å¼](##ä½¿ç”¨æ–¹å¼) ä¸­çš„è¯´æ˜ã€‚
3. ä½¿ç”¨ [Clash Party](https://github.com/mihomo-party-org/clash-party) / [Clash Verge Rev](https://github.com/clash-verge-rev/clash-verge-rev) / [Surge](https://nssurge.com/) ç­‰ä»£ç†å·¥å…·å°†æ¸¸æˆæµé‡å¯¼å‘ MitM ç«¯å£ï¼Œå…·ä½“åˆ†æµè§„åˆ™è¯·å‚é˜…åæ–‡ [ä½¿ç”¨æ–¹å¼](##ä½¿ç”¨æ–¹å¼) ä¸­çš„è¯´æ˜ã€‚

### æ”¯æŒçŠ¶å†µ

ç°åœ¨å¯¹äºå„ç«‹ç›´éº»å°†å¹³å°çš„æ”¯æŒçŠ¶å†µå¦‚ä¸‹ï¼š

| å¹³å°           | å››äººéº»å°† | ä¸‰äººéº»å°† | è‡ªåŠ¨æ‰“ç‰Œ  |
| -------------- | -------- | -------- | --------- |
| **é›€é­‚**       | &check;  | &check;  | \*&check; |
| **å¤©å‡¤**       | &check;  | &check;  | &cross;   |
| **éº»é›€ä¸€ç•ªè¡—** | &check;  | &check;  | \*&check; |
| **å¤©æœˆ**       | &check;  | &check;  | \*&check; |

æ³¨ï¼šè‡ªåŠ¨æ‰“ç‰Œä»…æ”¯æŒ [Windows Release ç‰ˆ](https://github.com/shinkuan/Akagi/releases)ï¼Œä¸” `ot_server` å¿…é¡»å¯ç”¨ã€‚

## å®‰è£…

### ä¸€èˆ¬ä½¿ç”¨è€…

å¯¹äº Windows å¹³å°çš„ç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ [release é¡µé¢](https://github.com/shinkuan/Akagi/releases) ä¸­çš„æœ€æ–°ç‰ˆï¼Œè§£å‹ç¼©åï¼Œå°† mjai bot æ”¾åˆ° `./Akagi/mjai_bot` ç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œ `run_akagi.exe` å³å¯ã€‚

### å¼€å‘è€…

å¯¹äºå¼€å‘è€…ï¼ˆæˆ– macOS ç­‰å…¶ä»–å¹³å°çš„ç”¨æˆ·ï¼‰ï¼Œå¯ä»¥ clone æ­¤é¡¹ç›®ï¼Œç„¶åä½¿ç”¨ Python 3.12 å®‰è£…ä¾èµ–ï¼Œå†å°† mjai bot æ”¾åˆ° `./Akagi/mjai_bot` ç›®å½•ä¸‹ï¼Œæ ¹æ®ä½ çš„å¹³å°ï¼Œé€‰æ‹©é€‚å½“çš„ libriichi åº“æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ `run_akagi.py` å³å¯ã€‚

```bash
git clone https://github.com/shinkuan/Akagi.git
cd Akagi
pip install -r requirements.txt
# å¯¹äºå›½å†…ç”¨æˆ·ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨æ¸…åæºæ¥åŠ é€Ÿä¾èµ–å®‰è£…ï¼š
# pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
mv ./mjai_bot/mortal/libriichi/libriichi-<version>-<platform>.<extension> ./mjai_bot/mortal/libriichi.<extension>
python run_akagi.py
```

å…³äºæ›´å¤š libriichi åº“æ–‡ä»¶çš„é€‰æ‹©ï¼š

-   å¯¹äº macOSï¼š
    -   M ç³»åˆ—èŠ¯ç‰‡ï¼š`libriichi-*-aarch64-apple-darwin.so`
    -   Intel èŠ¯ç‰‡ï¼š`libriichi-*-x86_64-apple-darwin.so`
-   å¯¹äº Windowsï¼š`libriichi-*-x86_64-pc-windows-msvc.pyd`
-   å¯¹äº Linuxï¼š`libriichi-*-x86_64-unknown-linux-gnu.so`

æ³¨æ„ï¼Œå…¶ä¸­çš„ `*` éœ€è¦æ ¹æ®ä½ çš„ Python ç‰ˆæœ¬è¿›è¡Œé€‰æ‹©ï¼Œç›®å‰æä¾›äº† Python 3.10/3.11/3.12 çš„ç‰ˆæœ¬ï¼Œä½†æœ¬é¡¹ç›®é»˜è®¤æ¨èä½¿ç”¨ Python 3.12ï¼Œå¦‚æœæ‚¨åœ¨å…¶ä»– Python ç‰ˆæœ¬ä¸Šé‡åˆ°äº†é—®é¢˜ï¼Œè¯·å°è¯•ä½¿ç”¨ Python 3.12 çš„ç‰ˆæœ¬ã€‚

å¦‚æœéœ€è¦è·å–æ›´å¤šä¿¡æ¯ / æºç ï¼Œå¯å‚è€ƒ [Mortal](https://github.com/Equim-chan/Mortal) é¡¹ç›®ã€‚

## ä½¿ç”¨æ–¹å¼

ä¸ºäº†ä½¿ç”¨ Akagiï¼Œä½ éœ€è¦è¿›è¡Œè¾ƒå¤šçš„å‡†å¤‡å·¥ä½œï¼Œè¯·ä»”ç»†é˜…è¯»ä¸‹æ–‡ã€‚

### æ£€æŸ¥é…ç½®ä¸ AI æ¨¡å‹

1. é€‰æ‹©æ¨¡å‹
    - ç‚¹é€‰å·¦ä¸‹è§’çš„ `Model` æŒ‰é’®
    - ä»æ¸…å•ä¸­é€‰æ‹©ä¸€ä¸ªæ¨¡å‹
    - è‹¥æ²¡æœ‰æ¨¡å‹ï¼Œå¯ä» [Discord](https://discord.gg/Z2wjXUK8bN) å–å¾—
    - å†…å»ºé¢„è®¾æ¨¡å‹ä¸ºå¼± AI
    - **3 äººå¯¹å±€è¯·é€‰æ‹© 3P æ¨¡å‹ï¼**
    - **ä¸è¦ç”¨ 4P æ¨¡å‹å‚ä¸ 3 äººå¯¹å±€ï¼**
2. æ£€æŸ¥è®¾å®š
    - ç‚¹é€‰å·¦ä¸‹è§’çš„ `Settings` æŒ‰é’®
    - æ£€æŸ¥è®¾å®šæ˜¯å¦æ­£ç¡®
    - å°† MitM ç±»å‹è®¾å®šä¸ºä½ æ­£åœ¨ç©çš„æ¸¸æˆ
    - è®¾å®šæ­£ç¡®çš„ MitM Host ä¸ Port
    - è‹¥ä¸æ¸…æ¥šï¼Œè¯·ä¿ç•™é¢„è®¾å€¼
    - é¢„è®¾å€¼: `host: 127.0.0.1, port: 7880`
    - è‹¥ä½ æœ‰å–å¾—åœ¨çº¿æœåŠ¡å™¨ API å¯†é’¥ï¼ˆåœ¨çº¿æœåŠ¡å™¨æä¾›æ›´å¼ºçš„ AI æ¨¡å‹ï¼Œå…¶æ°´å¹³ç›¸å½“äºé›€é­‚é­‚å¤©æ®µä½ï¼‰ï¼Œè¯·åœ¨é…ç½®ä¸­è¾“å…¥ï¼Œè‹¥ä½ æ²¡æœ‰ API å¯†é’¥ï¼Œå¯ä»¥ä» [Discord](https://discord.gg/Z2wjXUK8bN) è·å–ã€‚
3. ä¿å­˜è®¾å®š
    - ç‚¹é€‰ `Save` æŒ‰é’®
    - å°†è®¾å®šä¿å­˜ä¸‹æ¥
4. é‡æ–°å¯åŠ¨ Akagi
    - å…³é—­ Akagi å¹¶é‡æ–°å¼€å¯
    - é…ç½®æ‰ä¼šè¢«åº”ç”¨
5. å¯åŠ¨ MitM
    - ç‚¹é€‰å·¦ä¸‹è§’çš„ `MitM Stopped` æŒ‰é’®
    - è¿™ä¼šå¯åŠ¨ MitM ä»£ç†æœåŠ¡å™¨

### å®‰è£…å¹¶ä¿¡ä»» MitM Proxy è¯ä¹¦

#### Windows ç”¨æˆ·

1. å¼€å¯æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼ˆæŒ‰ä¸‹ `Windows é”® + E`ï¼‰
2. åœ¨ä¸Šæ–¹åœ°å€æ è¾“å…¥ `%USERPROFILE%\.mitmproxy`ï¼ˆmitmproxy çš„é»˜è®¤è¯ä¹¦å­˜å‚¨è·¯å¾„ï¼‰ç„¶åæŒ‰ Enter
3. æ‰¾åˆ°åä¸º `mitmproxy-ca-cert.cer` çš„è¯ä¹¦æ–‡ä»¶
4. åŒå‡»è¯¥è¯ä¹¦æ–‡ä»¶
5. ç‚¹é€‰ `å®‰è£…è¯ä¹¦` æŒ‰é’®
6. è‹¥å‡ºç°é€‰é¡¹ï¼Œè¯·é€‰ `æœ¬åœ°è®¡ç®—æœº`ï¼Œç„¶åç‚¹é€‰ä¸‹ä¸€æ­¥
7. é€‰æ‹© `å°†æ‰€æœ‰è¯ä¹¦æ”¾å…¥ä¸‹åˆ—å­˜å‚¨`ï¼Œç„¶åç‚¹ `æµè§ˆ...`
8. é€‰æ‹© `å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„`ï¼ŒæŒ‰ä¸‹ç¡®å®šï¼Œå†ç‚¹é€‰ä¸‹ä¸€æ­¥ä¸å®Œæˆ
9. è‹¥ç³»ç»Ÿè¦æ±‚æƒé™ï¼Œè¯·ç‚¹é€‰æ˜¯

#### macOS ç”¨æˆ·

1. æ‰“å¼€ Finder
2. æŒ‰ä¸‹ `Command + Shift + G` æ‰“å¼€å‰å¾€æ–‡ä»¶å¤¹å¯¹è¯æ¡†ï¼Œè¾“å…¥ `~/.mitmproxy` ç„¶åæŒ‰ Enter
3. æ‰¾åˆ°åä¸º `mitmproxy-ca-cert.cer` çš„è¯ä¹¦æ–‡ä»¶
4. åŒå‡»è¯¥è¯ä¹¦æ–‡ä»¶ï¼Œè¿›å…¥é’¥åŒ™ä¸²è®¿é—®
5. ç‚¹é€‰å·¦è¾¹çš„ `ç³»ç»Ÿé’¥åŒ™ä¸²` ä¸‹çš„ `ç³»ç»Ÿ` æ ‡ç­¾ï¼Œå³ä¸Šè§’æœç´¢ `mitmproxy`ï¼Œæ‰¾åˆ°å¯¼å…¥çš„è¯ä¹¦ï¼Œæ­¤æ—¶æ˜¯æœªä¿¡ä»»çŠ¶æ€
6. å³é”®åä¸º `mitmproxy` çš„è¯ä¹¦é¡¹ï¼Œé€‰æ‹© `æ˜¾ç¤ºç®€ä»‹`ï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­å±•å¼€ `ä¿¡ä»»`
7. å¯¹äº `ä½¿ç”¨æ­¤è¯ä¹¦æ—¶`ï¼Œæ”¹ä¸º `å§‹ç»ˆä¿¡ä»»`
8. å…³é—­çª—å£ï¼Œåœ¨å¼¹å‡ºçš„è®¤è¯æ¡†ä¸­å®Œæˆè®¤è¯å³å¯ã€‚

#### iOS / iPadOS ç”¨æˆ·

è‹¥ä½ é€šè¿‡åˆ†ç¦»éƒ¨ç½²çš„å½¢å¼å°†æœ¬é¡¹ç›®æ”¹ä¸ºäº†ä»£ç†èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥åœ¨ iOS / iPadOS ä¸Šä½¿ç”¨ï¼Œä½†æ­¤æ—¶ä»éœ€åœ¨å¯¹åº”è®¾å¤‡ä¸Šå®Œæˆè¯ä¹¦ä¿¡ä»»ã€‚

1. é¦–å…ˆå°†ç”µè„‘ä¸Šçš„ `mitmproxy-ca-cert.cer` è¯ä¹¦é€šè¿‡éš”ç©ºä¼ é€æˆ–è€…å…¶ä»–æ–¹å¼å‘é€åˆ° iPhone/iPad ä¸Šï¼Œæœ€å¥½æ˜¯éš”ç©ºæŠ•é€ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆå¯¼å…¥ã€‚å¯¹äºå…¶ä»–æ–¹å¼ï¼Œé¡»å…ˆä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†åœ¨æ–‡ä»¶ä¸­ç‚¹å¼€è¯¥è¯ä¹¦æ–‡ä»¶ã€‚
2. è¿›å…¥ `è®¾ç½®-å·²ä¸‹è½½æè¿°æ–‡ä»¶`ï¼Œç‚¹å‡»å®‰è£…
3. å‰å¾€ `é€šç”¨-å…³äºæœ¬æœº-è¯ä¹¦ä¿¡ä»»è®¾ç½®`ï¼Œæ‰“å¼€ mitmproxy çš„é€‰é¡¹

#### Android ç”¨æˆ·

æ— æµ‹è¯•ç¯å¢ƒï¼Œå¯è‡ªè¡Œæœç´¢ã€‚

### ä»£ç†è½¯ä»¶åˆ†æµ

Akagi é»˜è®¤åœ¨æœ¬åœ° `127.0.0.1:7880` å¯åŠ¨ä¸€ä¸ª HTTPS ä»£ç†ï¼ˆåŸºäº mitmproxyï¼‰ã€‚æ¨èä½¿ç”¨æ”¯æŒè§„åˆ™åˆ†æµå’Œè¦†å†™çš„ä»£ç†è½¯ä»¶ï¼ˆå¦‚ `Mihomo` ç³»çš„ `Clash Party` æˆ– `Clash Verge` / `Surge`ï¼‰ï¼Œå°†é›€é­‚ç›¸å…³æµé‡å¯¼å‘è¯¥ç«¯å£ï¼Œå¹¶ä½¿ç”¨å¤åˆè§„åˆ™ç»™ Python è¿›ç¨‹åšç›´è¿ä»¥é¿å…å›ç¯ã€‚

> [!NOTE]
>
> å¦‚æœä½ æƒ³è¦è”åŠ¨ä½¿ç”¨ [MajsoulMax](https://github.com/Avenshy/MajsoulMax) æˆ– [MajsoulMax-rs](https://github.com/Xerxes-2/MajsoulMax-rs) é¡¹ç›®ä½¿ç”¨ï¼Œéœ€è¦æ­å»ºå¤åˆä»£ç†é“¾ï¼Œå…·ä½“è¯·å‚é˜…åæ–‡è¿›é˜¶ä½¿ç”¨éƒ¨åˆ†ã€‚

ä»¥æœ¬åœ°èŠ‚ç‚¹ `Akagi`ï¼ˆHTTPS 127.0.0.1:7880ï¼‰ä¸ºä¾‹ï¼Œè§„åˆ™ä¸­éœ€è¦è®© Python è¿›ç¨‹ç›´è¿ï¼Œå†æŠŠæ¸¸æˆ / ç½‘é¡µæµé‡åˆ†æµåˆ°è¯¥èŠ‚ç‚¹ï¼Œå³å½¢æˆ `Game <-> Akagi <-> Server` çš„åŒå‘ä»£ç†é“¾æ¡ã€‚

#### Clash Party / Clash Verge é…ç½®ç¤ºä¾‹

```yml
proxies:
    - name: Akagi
      type: http
      server: 127.0.0.1
      port: 7880
      tls: true

proxy-groups:
    - name: ğŸ€„ é›€é­‚éº»å°†
      type: select
      proxies:
          - Akagi
          - DIRECT

rules:
    # é¿å…å›ç¯
    - AND, ((PROCESS-NAME-REGEX, python.*?), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT
    # å®¢æˆ·ç«¯ / Steam
    - PROCESS-NAME,Jantama_MahjongSoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,jantama_mahjongsoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†
    # ç½‘é¡µç‰ˆ
    - DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†
```

#### Surge é…ç½®ç¤ºä¾‹

```text
[Proxy]
Akagi = https, 127.0.0.1, 7880

[Proxy Group]
ğŸ€„ é›€é­‚éº»å°† = select, Akagi, DIRECT

[Rule]
# é¿å…å›ç¯ä»£ç†
AND, ((PROCESS-NAME, python*), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT
# å®¢æˆ·ç«¯ / Steam
PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†
# ç½‘é¡µç‰ˆ
DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†
```

#### Clash Verge å…¨å±€æ‰©å±•è„šæœ¬ï¼ˆJSï¼‰ç¤ºä¾‹

å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://www.clashverge.dev/guide/script.html)ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹æ³•è¿›è¡Œé…ç½®ã€‚

åœ¨ â€œè®¢é˜…â€ é¡µé¢å³é”® `å…¨å±€æ‰©å±•è„šæœ¬`ï¼Œé€‰æ‹© â€œç¼–è¾‘æ–‡ä»¶â€:

```js
function main(config) {
    config.proxies.push({
        name: 'Akagi',
        type: 'http',
        server: '127.0.0.1',
        port: 7880,
        tls: true,
    });

    config['proxy-groups'].push({
        name: 'ğŸ€„ é›€é­‚éº»å°†',
        type: 'select',
        proxies: ['DIRECT', 'Akagi'],
        icon: 'https://www.maj-soul.com/homepage/img/logotaiwan.png',
    });

    const bypass = [
        'AND, ((PROCESS-NAME-REGEX, python.*?), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT',
    ];

    const clientRules = [
        'PROCESS-NAME,Jantama_MahjongSoul.exe,ğŸ€„ é›€é­‚éº»å°†',
        'PROCESS-NAME,jantama_mahjongsoul.exe,ğŸ€„ é›€é­‚éº»å°†',
        'PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†',
    ];

    const webRules = [
        'DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†',
        'DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†',
        'DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†',
        'DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†',
    ];

    config.rules.unshift(...bypass, ...clientRules, ...webRules);
    return config;
}
```

#### Clash Partyï¼ˆåŸ Mihomo Partyï¼‰è¦†å†™ YAML ç¤ºä¾‹

å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://clashparty.org/docs/guide/override/yaml)ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½®ã€‚

åœ¨ Clash Party å·¦ä¾§ `è¦†å†™` é¡µé¢ç‚¹å‡» `+` å·ï¼Œé€‰æ‹© `æ–°å»º YAML`ï¼Œç„¶åå¤åˆ¶å¦‚ä¸‹å†…å®¹ï¼Œç‚¹å‡» `ç¡®è®¤` ä¿å­˜ï¼Œç„¶åç‚¹å‡»å¯¹åº”è¦†å†™å¡ç‰‡å³ä¸Šè§’çš„ `...` å›¾æ ‡ï¼Œé€‰æ‹© `ç¼–è¾‘ä¿¡æ¯` - `å…¨å±€å¯ç”¨`ã€‚

```yml
# https://mihomo.party/docs/guide/override/yaml
+proxies:
    - name: Akagi
      type: http
      server: 127.0.0.1
      port: 7880
      tls: true
+proxy-groups:
    - name: ğŸ€„ é›€é­‚éº»å°†
      proxies:
          - Akagi
          - DIRECT
      type: select
+rules:
    - AND, ((PROCESS-NAME-REGEX, python.*?), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT
    - PROCESS-NAME,Jantama_MahjongSoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,jantama_mahjongsoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†
```

### å¯åŠ¨å¯¹å±€

å®Œæˆä¸Šè¿°æµç¨‹åï¼Œä½ åº”å½“å°±å¯ä»¥è¿›è¡Œæ¸¸æˆå¯¹å±€å¹¶è·å¾— AI åˆ†æäº†ã€‚å»ºè®®å…ˆè¿›è¡Œäººæœºå¯¹å±€ä»¥æµ‹è¯•æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·é¦–å…ˆæ£€æŸ¥ Akagi ç›®å½•ä¸‹çš„ `logs` ç›®å½•ä¸‹çš„æ—¥å¿—ï¼Œæ’æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæ— æ³•è§£å†³ï¼Œå¯ä»¥è€ƒè™‘åˆ° [Discord](https://discord.gg/Z2wjXUK8bN) å¯»æ±‚å¸®åŠ©ï¼Œæˆ–åœ¨ Issue ä¸­æå‡ºã€‚

## è¿›é˜¶ä½¿ç”¨

### DataServer

DataServer æ˜¯ Akagi æ–°å¢çš„å¯é€‰åŠŸèƒ½ï¼Œé»˜è®¤å¼€å¯ï¼Œå…¶å¯ä»¥ä½œä¸º SSEï¼ˆServer Sent Eventsï¼‰æœåŠ¡å™¨ï¼Œå°† AI åˆ†æç»“æœå®æ—¶æ¨é€ç»™å‰ç«¯é¡µé¢è¿›è¡Œå±•ç¤ºã€‚è¿™å¯¹äºä½¿ç”¨æœåŠ¡ç«¯éƒ¨ç½²å¹¶åœ¨ iOS / iPadOS ä¸Šä½¿ç”¨æ˜¯å¿…è¦çš„ã€‚

ä¸ºäº†å¼€å¯ DataServerï¼Œä½ éœ€è¦åœ¨è®¾ç½®ä¸­ï¼ˆå¯ä»¥é€šè¿‡ TUI æˆ–è€…ä¿®æ”¹ `settings/settings.json` æ–‡ä»¶ä¸­çš„ `dataserver` å­—æ®µä¸º `true`ï¼‰å¼€å¯è¯¥åŠŸèƒ½ï¼Œç„¶åé‡æ–°å¯åŠ¨ Akagiã€‚

å¯åŠ¨ DataServer åï¼ŒAkagi ä¼šåœ¨ `0.0.0.0:8765` å¯åŠ¨ SSE æœåŠ¡å™¨ï¼Œä»è€Œä½ å¯ä»¥ä½¿ç”¨ [AkagiFrontend](https://github.com/zhuozhiyongde/AkagiFrontend) ä½œä¸ºå‰ç«¯å±•ç¤ºï¼Œå®Œæˆå‰åç«¯åˆ†ç¦»ï¼Œå¹¶å¾—ä»¥ä½¿ç”¨ PiPï¼ˆç”»ä¸­ç”»ï¼‰åŠŸèƒ½è€Œé TUI æ¥ä½œä¸ºç»“æœå±•ç¤ºã€‚è¿™å¯¹äºç”µè„‘ç«¯æ˜¯éå¿…é¡»çš„ï¼Œä½†æ˜¯å¯¹äºç§»åŠ¨ç«¯æ˜¯å”¯ä¸€çš„ä½¿ç”¨æ–¹å¼ã€‚

å¦‚æœä½ ä½¿ç”¨æƒ³è¦ä½¿ç”¨ VPS å°† Akagi å®Œå…¨ä½œä¸ºåç«¯æœåŠ¡éƒ¨ç½²ï¼Œå¹¶ä¸”ç¦ç”¨ TUIï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è®¾ç½®ä¸­ï¼ˆè¿˜æ˜¯é€šè¿‡ TUI æˆ–è€…ä¿®æ”¹ `settings/settings.json` æ–‡ä»¶ä¸­çš„ `tui` å­—æ®µä¸º `false`ï¼‰å…³é—­è¯¥åŠŸèƒ½ï¼Œç„¶åé‡æ–°å¯åŠ¨ Akagiã€‚æ­¤æ—¶ä½ åªèƒ½é€šè¿‡ DataServer çš„ SSE æœåŠ¡ç«¯å£è·å–ç»“æœã€‚

å¦‚æœä½ åŒæ—¶ç¦ç”¨äº† DataServer å’Œ TUIï¼Œé‚£ä¹ˆä½ å°†æ— æ³•è·å–æ¨¡å‹æ¨ç†ç»“æœã€‚

### ä¸ MajsoulMax è”åŠ¨

MajsoulMax æ˜¯ä¸€ä¸ªç”¨äºè§£é”é›€é­‚çš®è‚¤çš„é¡¹ç›®ï¼Œå…¶åŸç†å’Œ Akagi ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ MITM ä»£ç†æœåŠ¡å™¨æ‹¦æˆªæ¸¸æˆæµé‡ï¼Œç„¶åè¿›è¡Œå¤„ç†ã€‚ç”±äºäºŒè€…éƒ½éœ€è¦è¿›è¡Œ MitMï¼Œæ‰€ä»¥ä½ éœ€è¦é…ç½®ä»£ç†é“¾è®©æµé‡ä¸²è¡Œç»è¿‡ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦åŒæ—¶ä¿¡ä»»äºŒè€…çš„è¯ä¹¦ã€‚æ­¤æ—¶å°¤å…¶éœ€è¦æ³¨æ„é¿å…å›ç¯ä»£ç†çš„é—®é¢˜ã€‚

MajsoulMax å­˜åœ¨ä¸¤ä¸ªåˆ†æ”¯ç‰ˆæœ¬ï¼š[Python](https://github.com/Avenshy/MajsoulMax) å’Œ [Rust](https://github.com/Xerxes-2/MajsoulMax-rs)ã€‚

å¯¹åº”çš„ï¼Œè¿™é‡Œä¹Ÿæœ‰åŸºäº MajsoulMax-rs å’ŒåŸºäº MajsoulMax çš„ä¸¤ç§é…ç½®ï¼Œé…ç½®ç›¸è¿‘ï¼Œä¸åŒç‚¹åœ¨äºï¼š

1. MajsoulMax-rsï¼ˆRustï¼‰å¯åŠ¨çš„æ˜¯ HTTP ä»£ç†ï¼ˆåŸºäº hudsuckerï¼‰ï¼Œä¸”é“¾å¼ä»£ç†æ—¶ï¼Œåˆå§‹åŒ–çš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼Œä½†æ˜¯åˆ†æµç®€å•ã€ä½¿ç”¨æ–¹ä¾¿ã€æ— éœ€ç¯å¢ƒä¾èµ–ç®¡ç†ã€‚
2. MajsoulMaxï¼ˆPythonï¼‰å¯åŠ¨çš„æ˜¯ HTTPS ä»£ç†ï¼ˆåŸºäº mitmproxyï¼‰ï¼Œå¯ä»¥å®Œç¾è¿›è¡Œé“¾å¼ä»£ç†ã€‚

#### Rust ç‰ˆæœ¬é…ç½®

Rust ç‰ˆæœ¬ä»£ç†é“¾æ¡å¦‚ä¸‹ï¼š

```
Game <-> majsoul_max_rs(23410, http) <-> akagi(7880, https) <-> Server
```

è¿™é‡Œåˆ†æµå®Œå…¨ä¾èµ–äºä½ çš„ä»£ç†è½¯ä»¶ï¼Œç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š

Clashï¼š

```yaml
proxies:
    - name: MajsoulMax
      port: 23410
      server: 127.0.0.1
      tls: false
      type: http
    - name: Akagi
      port: 7880
      server: 127.0.0.1
      tls: true
      type: http
proxy-groups:
    - name: ğŸ€„ é›€é­‚éº»å°†
      proxies:
          - MajsoulMax
          - DIRECT
      type: select
rules:
    # é¿å… Akagi å›ç¯ä»£ç†
    - AND, ((PROCESS-NAME-REGEX, python.*?), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT
    # å¼ºåˆ¶å°† majsoul_max_rs çš„æµé‡å¯¼å‘ akagi
    - PROCESS-NAME-REGEX,majsoul_max_rs.*?,Akagi
    # å°†é›€é­‚æ¸¸æˆæµé‡åˆ†æµ
    # å®¢æˆ·ç«¯ / Steam
    - PROCESS-NAME,Jantama_MahjongSoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,jantama_mahjongsoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†
    # ç½‘é¡µç«¯
    - DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†
```

Surgeï¼š

```text
[Proxy]
MajsoulMax = http, 127.0.0.1, 23410
Akagi = http, 127.0.0.1, 7880

[Proxy Group]
ğŸ€„ é›€é­‚éº»å°† = select, MajsoulMax, DIRECT

[Rule]
AND, ((PROCESS-NAME-REGEX, python.*?), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT
PROCESS-NAME,majsoul_max_rs,Akagi
# å®¢æˆ·ç«¯ / Steam
PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†
# ç½‘é¡µç‰ˆ
DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†
```

#### Python ç‰ˆæœ¬é…ç½®

Python ç‰ˆæœ¬ä»£ç†é“¾æ¡å¦‚ä¸‹ï¼š

```
Game <-> MajsoulMax(23410, https) <-> akagi(7880, https) <-> Server
```

æ³¨æ„ï¼ŒMajsoulMaxï¼ˆPythonï¼‰å’Œ Akagi ç¯å¢ƒä¸å…¼å®¹ï¼Œå¯¹äº `protobuf` çš„ç‰ˆæœ¬è¦æ±‚æœ‰å·®åˆ«ï¼Œæ‰€ä»¥ä½ å¿…é¡»ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„ç¯å¢ƒæ¥åˆ†åˆ«å¯åŠ¨ä»–ä»¬ï¼Œæˆ–è€…ä½¿ç”¨ Vendor æ¥å¯¹æ­¤ä¾èµ–é¡¹è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚

> æˆ–è€…ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ [MajsoulHelper](https://github.com/zhuozhiyongde/MajsoulHelper) æ¥å®¹å™¨åŒ–å¯åŠ¨ä»–ä»¬ä¸¤ä¸ªã€‚

æ­¤æ—¶ï¼Œä½ éœ€è¦æŒ‡å®š upstream ä¸º Akagi çš„ç«¯å£å¹¶å…è®¸ä¸å®‰å…¨è¿æ¥æ¥å¯åŠ¨ MajsoulMaxï¼Œä¹Ÿå³ä¸Šè¿°ä»£ç†é“¾ä¸­çš„ç¬¬äºŒä¸ª `<->` éœ€è¦é€šè¿‡ä»£ç†è½¯ä»¶ä¹‹å¤–çš„æ–¹å¼å®Œæˆï¼š

```shell
mitmdump -p 23410 --mode upstream:http://127.0.0.1:7880 -s addons.py --ssl-insecure
```

ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š

Clashï¼š

```yaml
proxies:
    - name: MajsoulMax
      port: 23410
      server: 127.0.0.1
      tls: true
      type: http
proxy-groups:
    - name: ğŸ€„ é›€é­‚éº»å°†
      proxies:
          - MajsoulMax
          - DIRECT
      type: select
rules:
    # é¿å… Akagiã€MajsoulMax å›ç¯ä»£ç†
    - AND, ((PROCESS-NAME-REGEX, python.*?), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT
    # å°†é›€é­‚æ¸¸æˆæµé‡åˆ†æµ
    # å®¢æˆ·ç«¯ / Steam
    - PROCESS-NAME,Jantama_MahjongSoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,jantama_mahjongsoul.exe,ğŸ€„ é›€é­‚éº»å°†
    - PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†
    # ç½‘é¡µç«¯
    - DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†
    - DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†
```

Surgeï¼š

```text
[Proxy]
MajsoulMax = https, 127.0.0.1, 23410

[Proxy Group]
ğŸ€„ é›€é­‚éº»å°† = select, MajsoulMax, DIRECT

[Rule]
AND, ((PROCESS-NAME-REGEX, python.*?), (OR, ((DOMAIN-KEYWORD, majsoul), (DOMAIN-KEYWORD, maj-soul), (DOMAIN-KEYWORD, mahjongsoul), (DOMAIN-KEYWORD, catmjstudio)))), DIRECT
# å®¢æˆ·ç«¯ / Steam
PROCESS-NAME,é›€é­‚éº»å°‡,ğŸ€„ é›€é­‚éº»å°†
# ç½‘é¡µç‰ˆ
DOMAIN-KEYWORD,majsoul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,maj-soul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,mahjongsoul,ğŸ€„ é›€é­‚éº»å°†
DOMAIN-KEYWORD,catmjstudio,ğŸ€„ é›€é­‚éº»å°†
```

## æ“ä½œæ¼”ç¤º

### å¯åŠ¨ MitM ä»£ç†æœåŠ¡å™¨

![image](./docs/gifs/start_mitm.gif)

### é€‰æ‹© AI æ¨¡å‹

æ¨¡å‹å‚¨å­˜åœ¨ `./mjai_bot/` èµ„æ–™å¤¹

![image](./docs/gifs/select_model.gif)

### å˜æ›´è®¾å®š

> [!IMPORTANT]
>
> é‡å¯åè®¾å®šæ‰ä¼šè¢«åº”ç”¨

![image](./docs/gifs/settings.gif)

### å¼€å¯æ—¥å¿—

å‡ºç°é—®é¢˜æ—¶å¯å¼€å¯æ—¥å¿—ä»¥äº†è§£çŠ¶å†µï¼Œå¹¶åŒæ—¶å‘å¼€å‘è€…æŠ¥å‘Šã€‚

å‚¨å­˜è·¯å¾„ï¼š`./logs/`

![image](./docs/gifs/logs_screen.gif)

### åˆ‡æ¢ MJAI å†…å®¹

ç‚¹é€‰è¯¥è§†çª—å³å¯åˆ‡æ¢

![image](./docs/gifs/change_window.gif)

### AutoPlay

> [!NOTE]
>
> AutoPlay ä»…åœ¨ Windows Release ç‰ˆä¸­å¯ç”¨ï¼Œä¸”å¿…é¡»å¯åŠ¨ ot_serverã€‚

ç¡®ä¿æ¸¸æˆå®¢æˆ·ç«¯çš„æ˜¾ç¤ºæ¯”ä¾‹è®¾å®šä¸º 16:9

![image](./docs/images/autoplay_example/good.png)

![image](./docs/images/autoplay_example/bad_1.png)

![image](./docs/images/autoplay_example/bad_2.png)

### æ›´æ¢ä¸»é¢˜

![image](./docs/gifs/change_theme.gif)

### ç«‹ç›´å®£å‘Š

ç”±äº MJAI åè®®çš„é™åˆ¶ï¼Œå»ºè®®æ ä¸ºç«‹ç›´æ—¶å¹¶ä¸ä¼šæ˜¾ç¤ºå¼ƒç‰Œã€‚

ä½ å¿…é¡»æ‰‹åŠ¨ç‚¹å‡»ç«‹ç›´æŒ‰é’®æ¥å®£å‘Šç«‹ç›´ã€‚

![image](./docs/gifs/call_reach.gif)

## å¸¸è§é—®é¢˜

ä½ å¯ä»¥åˆ° [Discord](https://discord.gg/Z2wjXUK8bN) æˆ– Issue é¡µé¢ä¸Šè¯¢é—®é—®é¢˜ã€‚

> [!TIP]
>
> è‹¥ä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·é™„ä¸Šæ—¥å¿—æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘æ‰èƒ½æ›´å¿«åœ°å¸®åŠ©ä½ ã€‚
>
> æ—¥å¿—æ–‡ä»¶ä½äº `./logs/` èµ„æ–™å¤¹ä¸­ã€‚

### MitM Proxy æ— æ³•å¯åŠ¨

-   ç¡®è®¤æ˜¯å¦æœ‰å…¶ä»–åº”ç”¨å ç”¨ç«¯å£
-   ç¡®è®¤æ˜¯å¦æœ‰å®‰è£…å¹¶ä¿¡ä»» MitM Proxy è¯ä¹¦
-   ç¡®è®¤è®¾å®šçš„ Host ä¸ Port æ˜¯å¦æ­£ç¡®
-   ç¡®è®¤æ˜¯å¦æœ‰é˜²ç«å¢™é˜»æŒ¡ MitM Proxy
-   ç¡®è®¤ MitM Proxy Server æ˜¯å¦å·²ç»å¯åŠ¨
-   å¦‚æœè¿˜æ˜¯æ— æ³•å¯åŠ¨ï¼Œè¯·å‚è€ƒ [è¿™ä¸ª Issue](https://github.com/shinkuan/Akagi/issues/57)ã€‚

## å¼€å‘

### é¡¹ç›®ç»“æ„

```shell
.
â”œâ”€â”€ akagi # Akagi çš„ Textual UI
â”œâ”€â”€ autoplay # AutoPlay çš„å®ç°
â”œâ”€â”€ dataserver # DataServer çš„å®ç°
â”œâ”€â”€ logs # æ—¥å¿—å‚¨å­˜ç›®å½•
â”œâ”€â”€ mitm # MitM ä»£ç†æœåŠ¡å™¨
â”‚   â”œâ”€â”€ bridge # æ¸¸æˆå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„æ¡¥æ¥å™¨ï¼Œç”¨æ¥è½¬æ¢ä¸º MJAI åè®®
â”‚   â”‚   â”œâ”€â”€ amatsuki # å¤©æœˆæ¡¥æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ majsoul # é›€é­‚æ¡¥æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ riichi_city # ä¸€ç•ªè¡—æ¡¥æ¥å™¨
â”‚   â”‚   â”œâ”€â”€ tenhou # å¤©å‡¤æ¡¥æ¥å™¨
â”‚   â”‚   â””â”€â”€ unified # ç»Ÿä¸€æ¡¥æ¥å™¨
â”œâ”€â”€ mjai_bot # MJAI æœºå™¨äºº
â”‚   â”œâ”€â”€ base # æœºå™¨äººåŸºç¡€ç±»åˆ«ï¼Œå¯å‚è€ƒè‡ªåˆ¶æœºå™¨äºº
â”‚   â”œâ”€â”€ mortal # é»˜è®¤çš„å››äººéº»å°†æ¨¡å‹
â”‚   â””â”€â”€ mortal3p # é»˜è®¤çš„ä¸‰äººéº»å°†æ¨¡å‹
â”œâ”€â”€ settings # è®¾ç½®æ–‡ä»¶å¤¹
â””â”€â”€ run_akagi.py # å¯åŠ¨ä»£ç 
```

### æ¡¥æ¥å™¨

è¦åˆ¶ä½œä¸€ä¸ªæ¡¥æ¥å™¨ï¼Œä½ éœ€è¦å®ç°ä¸¤éƒ¨åˆ†ï¼š

1. `mitm/bridge/mitm_abc.py` ä¸­çš„ `ClientWebSocketABC`
2. `mitm/bridge/bridge_base.py` ä¸­çš„ `Bridge`

ClientWebSocketABC æ˜¯ mitmproxy çš„ addonï¼ŒåŠŸèƒ½æ˜¯å°†æ¸¸æˆåè®®è½¬ä¸º MJAI åè®®å¹¶æ¨å…¥ `mjai_messages: queue.Queue[dict] = queue.Queue()`ã€‚å¯å‚è€ƒ `mitm/majsoul/`ã€‚

Bridge ä¸ºæ¡¥æ¥ä¸»ç±»åˆ«ï¼Œä½ éœ€è¦å®ç° `parse()` æ–¹æ³•ï¼Œå°†æ¸¸æˆæ”¶åˆ°çš„èµ„æ–™è§£æä¸º `None | list[dict]`ï¼Œå¯å‚è€ƒ `mitm/bridge/amatsuki/bridge.py`ã€‚

### MJAI æœºå™¨äºº

è¦åˆ¶ä½œ MJAI æœºå™¨äººï¼Œä½ éœ€è¦å®ç° `mjai_bot/base/bot.py` ä¸­çš„ `Bot` ç±»åˆ«ã€‚

> TODO: åˆ¶ä½œä¸€ä¸ª tsumogiri bot èŒƒä¾‹

## TODO

-   [x] æ”¯æŒä¸‰äººéº»å°†
-   [x] æ”¯æŒ RiichiCity
-   [x] ç«‹ç›´åæ¨èåˆ‡ç‰Œ
-   [ ] æ åæ¨èåˆ‡ç‰Œï¼ˆæå°‘è§ï¼‰

## ä½œè€…

-   [Shinkuan](https://github.com/shinkuan/) - shinkuan318@gmail.com
-   [Discord](https://discord.gg/Z2wjXUK8bN)

## æˆæƒæ¡æ¬¾

```
â€œCommons Clauseâ€ License Condition v1.0

The Software is provided to you by the Licensor under the License, as defined below, subject to the following condition.

Without limiting other conditions in the License, the grant of rights under the License will not include, and the License does not grant to you, the right to Sell the Software.

For purposes of the foregoing, â€œSellâ€ means practicing any or all of the rights granted to you under the License to provide to third parties, for a fee or other consideration (including without limitation fees for hosting or consulting/ support services related to the Software), a product or service whose value derives, entirely or substantially, from the functionality of the Software. Any license notice or attribution required by the License must also include this Commons Clause License Condition notice.

Software: Akagi

License: GNU Affero General Public License version 3 with Commons Clause

Licensor: shinkuan
```
